---
stitle: "Capstone"
author: "Klaas Berbee & Thierry Ligeon"
date: "25-10-2017"
header-includes: \usepackage{hyperref,pdfpages,graphicx}
output: 
  pdf_document:
    number_sections: true
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
\begin{titlepage}
\centering
	\includegraphics[width=0.15\textwidth]{intro}\par\vspace{1cm}
	{\scshape\LARGE Hogeschool van Amsterdam \par}
	\vspace{1cm}
	{\scshape\Large Capstone Big-Data in urban technology\par}
	\vspace{1.5cm}
	{\huge\bfseries Batting\par}
	\vspace{2cm}
	{\Large\itshape Klaas Berbee\par}
	{\Large\itshape Thierry Ligeon\par}
	\vfill
	supervised by\par
	Dr.~J.R. \textsc{Helmus}

	\vfill

% Bottom of the page
	{\large \today\par}


\end{titlepage}
\flushleft
\pagebreak
\tableofcontents
\pagebreak
\textit{This page is intentionally left blank.}
\pagebreak
\section{Capstone Batting}
\textit{Klaas Berbee \& Thierry Ligeon}

Voor de capstone van de minor Big-Data in urban technology aan de Hogeschool van Amsterdam moeten wij de Batting dataset gaan bestuderen. Als eerste beginnen we met het globaal inzicht krijgen van de dataset.

\subsection{Context van de dataset}

De Batting dataset bevat data over o.a.: teams, spelers en managers. Ook bevat de dataset informatie over hun salarissen en skills. Verder bevat deze dataset informatie over hoe de individuele wedstrijden verlopen zijn, welke activiteiten hierin zijn voorgekomen en door wie deze zijn uitgevoerd. 

Het doel is om deze dateset om te zetten naar nuttige informatie en dit vervolgens conclusies uit kunnen trekken. Teams kunnen bijvoorbeeld een inzicht krijgen in welke factoren een grote rol spelen in de prestatie van het team.


\subsubsection{Belanghebbende voor deze dataset}

\begin{description}

\item[Kansspel spelers] \hfill \\
Er kan een voordeel voor kansspelspelers ontstaan zodra zij bezitten over voorspelmodellen voor komende wedstrijden.

\item[Teamcoaches] \hfill \\
De coach kan uit de dataset de sterke en zwakke punten van de spelers inzien. Hierop kan hij zijn trainingen specificeren op bepaalde aspecten voor zijn spelers. Daarnaast kunnen de sterke en zwakke punten van de competitie bekeken worden om zo beter voor te kunnen bereiden oo aankomende wedstrijden.

\item[Junior spelers] \hfill \\
Beginnende spelers kunnen hun idolen en vaardigheden vergelijken en bekijken bij welke club zij getraind hebben. Dit zou een aanleiding kunnen zijn om een club te kiezen

\item[Stadions] \hfill \\
Met deze dataset kan de hoeveelheid bezoekers voorspeld worden. Hierop kunnen prijzen, hoeveelheid beveiliging en promotie op worden aangepast.

\end{description}

\subsubsection{Hoe de dataset tot stand gekomen is}
Deze dataset is initieel opgezet door Sean Lahman in 1994. De dataset bevat data van 1871 tot 2012\cite{seanlahman}. Echter is deze dataset enkele keren herschreven naar een nieuw format. Daarnaast hebben ook meerdere mensen bijgedragen aan deze dataset. Hierdoor zouden er mogelijke imperfecties in de dataset kunnen zijn onstaan.

\subsubsection{Hedendaagse problemen oplossen m.b.v. deze dataset}
De World Series MLB 2017 is in november afgesloten en gewonnen door de Houston Astros\cite{houstonastros}.  Er zouden modellen gemaakt kunnen worden op basis van de data van afgelopen jaren, en vergeleken kunnen worden met de uitslag van 2017. Hierop kan een deel van de prestatie van het model worden gebaseerd.

```{r include_Packages, echo=FALSE, message=FALSE}
if (!require("dplyr")) install.packages("dplyr")
if (!require("RMySQL")) install.packages("RMySQL")
library(dplyr)
library(RMySQL)
```
\subsection{Data importeren via mySQL}
Verbinding maken met de mySQL database.

Vervolgens maken we verbinding met de locale mySQL server. Vervolgens drukken we alle tabellen van de database af.
```{r connecting_to_mySQL}
my_db <- dbConnect(MySQL(), 
                   user='klaasberbee', 
                   password='119OKVU', 
                   dbname='Batting', 
                   host='localhost')

print(dbListTables(my_db))
```
Hier kunnen we zien dat de Batting dataset uit 27 verschillende tabellen bestaat. Uit de ERD analyse was gebleken dat ..... de belangrijkste tabellen zijn.

```{r Loding all tables}
dbTables <- dbListTables(my_db)

allTables <-
  lapply(dbTables, function(table) {
    dbGetQuery(my_db, paste("select * from", table))
  })
names(allTables) <- paste("db", dbTables, sep = "_")
list2env(allTables, envir = .GlobalEnv)
```

Doormiddel van de onderstaande code kan er uitgezocht worden wat de Primary Keys zijn.
```{r welke column is de p key, echo=FALSE, message=FALSE}
db_AllstarFull[(duplicated(db_AllstarFull[c("playerID","gameID")])
                 | duplicated(db_AllstarFull[c("playerID","gameID")], fromLast = TRUE)), ]
db_Appearances[(duplicated(db_Appearances[c("playerID","yearID","teamID")])
                 | duplicated(db_Appearances[c("playerID","yearID", "teamID")], fromLast = TRUE)), ]
db_AwardsManagers[(duplicated(db_AwardsManagers[c("playerID","awardID", "yearID")])
                 | duplicated(db_AwardsManagers[c("playerID","awardID", "yearID")], fromLast = TRUE)),]
db_AwardsPlayers[(duplicated(db_AwardsPlayers[c("playerID","awardID", "yearID", "lgID")])
                 | duplicated(db_AwardsPlayers[c("playerID","awardID", "yearID", "lgID")], fromLast = TRUE)),]
db_AwardsShareManagers[(duplicated(db_AwardsShareManagers[c("playerID", "yearID")])
                 | duplicated(db_AwardsShareManagers[c("playerID", "yearID")], fromLast = TRUE)), ]
db_AwardsSharePlayers[(duplicated(db_AwardsSharePlayers[c("playerID", "yearID", "awardID")])
                 | duplicated(db_AwardsSharePlayers[c("playerID", "yearID", "awardID")], fromLast = TRUE)),]
db_Batting[(duplicated(db_Batting[c("playerID", "yearID", "stint")])
                 | duplicated(db_Batting[c("playerID", "yearID", "stint")], fromLast = TRUE)), ]
db_BattingPost[(duplicated(db_BattingPost[c("playerID", "yearID", "round")])
                 | duplicated(db_BattingPost[c("playerID", "yearID", "round")], fromLast = TRUE)), ]
db_CollegePlaying[(duplicated(db_CollegePlaying[c("playerID", "yearID", "schoolID")])
                 | duplicated(db_CollegePlaying[c("playerID", "yearID", "schoolID")], fromLast = TRUE)),]
db_Fielding[(duplicated(db_Fielding[c("playerID", "yearID", "stint", "POS")])
                 | duplicated(db_Fielding[c("playerID", "yearID", "stint", "POS")], fromLast = TRUE)),]
db_FieldingOF[(duplicated(db_FieldingOF[c("playerID", "yearID", "stint")])
                 | duplicated(db_FieldingOF[c("playerID", "yearID", "stint")], fromLast = TRUE)),]
db_FieldingOFsplit[(duplicated(db_FieldingOFsplit[c("playerID", "yearID", "stint", "POS")])
                 | duplicated(db_FieldingOFsplit[c("playerID", "yearID", "stint", "POS")], fromLast = TRUE)),]
db_FieldingPost[(duplicated(db_FieldingPost[c("playerID", "yearID", "round", "POS")])
                 | duplicated(db_FieldingPost[c("playerID", "yearID", "round", "POS")], fromLast = TRUE)),]
db_HallOfFame[(duplicated(db_HallOfFame[c("playerID", "yearid", "votedBy")])
                 | duplicated(db_HallOfFame[c("playerID", "yearid", "votedBy")], fromLast = TRUE)),]
db_HomeGames[(duplicated(db_HomeGames[c("year.key", "team.key", "park.key")])
                 | duplicated(db_HomeGames[c("year.key", "team.key", "park.key")], fromLast = TRUE)),]
db_Managers[(duplicated(db_Managers[c("playerID", "yearID", "inseason")])
                 | duplicated(db_Managers[c("playerID", "yearID", "inseason")], fromLast = TRUE)),]
db_ManagersHalf[(duplicated(db_ManagersHalf[c("playerID","yearID","half")])
                 | duplicated(db_ManagersHalf[c("playerID","yearID","half")], fromLast = TRUE)), ]
db_Master[(duplicated(db_Master["playerID"])
                 | duplicated(db_Master["playerID"], fromLast = TRUE)), ]
db_Parks[(duplicated(db_Parks["park.key"])
                 | duplicated(db_Parks["park.key"], fromLast = TRUE)), ]
db_Pitching[(duplicated(db_Pitching[c("playerID", "yearID", "stint")])
                 | duplicated(db_Pitching[c("playerID", "yearID", "stint")], fromLast = TRUE)), ]
db_PitchingPost[(duplicated(db_PitchingPost[c("playerID", "yearID", "round")])
                 | duplicated(db_PitchingPost[c("playerID", "yearID", "round")], fromLast = TRUE)), ]
db_Salaries[(duplicated(db_Salaries[c("playerID", "yearID", "teamID")])
                 | duplicated(db_Salaries[c("playerID", "yearID", "teamID")], fromLast = TRUE)), ]
db_Schools[(duplicated(db_Salaries["schoolID", ])
                 | duplicated(db_Salaries["schoolID", ], fromLast = TRUE)), ]
db_SeriesPost[(duplicated(db_SeriesPost[c("yearID", "round")])
                 | duplicated(db_SeriesPost[c("yearID", "round")], fromLast = TRUE)), ]
db_Teams[(duplicated(db_Teams[c("yearID", "teamID")])
                 | duplicated(db_Teams[c("yearID", "teamID")], fromLast = TRUE)), ]
db_TeamsFranchises[(duplicated(db_TeamsFranchises[c("franchID")])
                 | duplicated(db_TeamsFranchises[c("franchID")], fromLast = TRUE)), ]
db_TeamsHalf[(duplicated(db_TeamsHalf[c("teamID", "Half")])
                 | duplicated(db_TeamsHalf[c("teamID", "Half")], fromLast = TRUE)), ]
glimpse(db_AllstarFull)

db_Managers %>%
  filter(yearID == 1892)

db_ManagersHalf %>%
  filter(yearID == 1892)
nrow(db_AwardsManagers)
```

\begin{thebibliography}{9}

\bibitem{seanlahman} 
Sean Lahman, Batting database explanation 2012,
\\\texttt{http://seanlahman.com/files/database/readme2012.txt}

\bibitem{houstonastros}
AD: Houston Astros verslaan Los Angeles Dodgers, 2017,
\\\texttt{https://www.ad.nl/andere-sporten/houston-astros-verslaan-los-angeles-dodgers-met-5-1~a6904dad}
\end{thebibliography}